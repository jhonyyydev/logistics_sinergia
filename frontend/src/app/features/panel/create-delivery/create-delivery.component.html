<div class="min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
  <div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">Registrar Nueva Entrega</h1>
      <p class="text-lg text-gray-600">Complete la información para registrar una nueva entrega</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="bg-white rounded-lg shadow-sm border p-8 text-center">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"></div>
      <p class="text-gray-600 font-medium">Cargando datos...</p>
    </div>

    <!-- Form -->
    <form *ngIf="!isLoading" [formGroup]="deliveryForm" (ngSubmit)="onSubmit()" class="space-y-8">

      <!-- Información del Producto -->
      <div class="bg-white rounded-lg shadow-sm border p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-6 pb-2 border-b border-gray-200">Información del Producto</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-2">
            <label for="product_id" class="block text-sm font-medium text-gray-700">Producto *</label>
            <select
              id="product_id"
              formControlName="product_id"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"
              [class.border-red-500]="isFieldInvalid('product_id')"
              [class.focus:ring-red-500]="isFieldInvalid('product_id')"
              [class.focus:border-red-500]="isFieldInvalid('product_id')">
              <option value="">Seleccione un producto</option>
              <option *ngFor="let product of products" [value]="product.id">
                {{ product.name }} ({{ product.type === 'maritime' ? 'Marítimo' : 'Terrestre' }})
              </option>
            </select>
            <div *ngIf="isFieldInvalid('product_id')" class="text-sm text-red-600 mt-1">
              {{ getFieldError('product_id') }}
            </div>
          </div>

          <div class="space-y-2">
            <label for="product_type" class="block text-sm font-medium text-gray-700">Tipo de Producto *</label>
            <select
              id="product_type"
              formControlName="product_type"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"
              [class.border-red-500]="isFieldInvalid('product_type')"
              [class.focus:ring-red-500]="isFieldInvalid('product_type')"
              [class.focus:border-red-500]="isFieldInvalid('product_type')">
              <option value="">Seleccione el tipo</option>
              <option *ngFor="let type of productTypes" [value]="type">
                {{ productTypeLabels[type] }}
              </option>
            </select>
            <div *ngIf="isFieldInvalid('product_type')" class="text-sm text-red-600 mt-1">
              {{ getFieldError('product_type') }}
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
          <div class="space-y-2">
            <label for="quantity" class="block text-sm font-medium text-gray-700">Cantidad *</label>
            <input
              type="number"
              id="quantity"
              formControlName="quantity"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"
              [class.border-red-500]="isFieldInvalid('quantity')"
              [class.focus:ring-red-500]="isFieldInvalid('quantity')"
              [class.focus:border-red-500]="isFieldInvalid('quantity')"
              min="1"
              placeholder="Ingrese la cantidad">
            <div *ngIf="isFieldInvalid('quantity')" class="text-sm text-red-600 mt-1">
              {{ getFieldError('quantity') }}
            </div>
          </div>

          <div class="space-y-2">
            <label for="shipping_price" class="block text-sm font-medium text-gray-700">Precio de Envío *</label>
            <input
              type="number"
              id="shipping_price"
              formControlName="shipping_price"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"
              [class.border-red-500]="isFieldInvalid('shipping_price')"
              [class.focus:ring-red-500]="isFieldInvalid('shipping_price')"
              [class.focus:border-red-500]="isFieldInvalid('shipping_price')"
              min="0"
              step="0.01"
              placeholder="0.00">
            <div *ngIf="isFieldInvalid('shipping_price')" class="text-sm text-red-600 mt-1">
              {{ getFieldError('shipping_price') }}
            </div>
          </div>
        </div>
      </div>

      <!-- Información de Fechas -->
      <div class="bg-white rounded-lg shadow-sm border p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-6 pb-2 border-b border-gray-200">Información de Fechas</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-2">
            <label for="log_date" class="block text-sm font-medium text-gray-700">Fecha de Registro *</label>
            <input
              type="date"
              id="log_date"
              formControlName="log_date"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"
              [class.border-red-500]="isFieldInvalid('log_date')"
              [class.focus:ring-red-500]="isFieldInvalid('log_date')"
              [class.focus:border-red-500]="isFieldInvalid('log_date')">
            <div *ngIf="isFieldInvalid('log_date')" class="text-sm text-red-600 mt-1">
              {{ getFieldError('log_date') }}
            </div>
          </div>

          <div class="space-y-2">
            <label for="delivery_date" class="block text-sm font-medium text-gray-700">Fecha de Entrega *</label>
            <input
              type="date"
              id="delivery_date"
              formControlName="delivery_date"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"
              [class.border-red-500]="isFieldInvalid('delivery_date')"
              [class.focus:ring-red-500]="isFieldInvalid('delivery_date')"
              [class.focus:border-red-500]="isFieldInvalid('delivery_date')">
            <div *ngIf="isFieldInvalid('delivery_date')" class="text-sm text-red-600 mt-1">
              {{ getFieldError('delivery_date') }}
            </div>
          </div>
        </div>
      </div>

      <!-- Información de Guía -->
      <div class="bg-white rounded-lg shadow-sm border p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-6 pb-2 border-b border-gray-200">Información de Guía</h2>

        <div class="space-y-2">
          <label for="guide" class="block text-sm font-medium text-gray-700">Número de Guía *</label>
          <input
            type="text"
            id="guide"
            formControlName="guide"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"
            [class.border-red-500]="isFieldInvalid('guide')"
            [class.focus:ring-red-500]="isFieldInvalid('guide')"
            [class.focus:border-red-500]="isFieldInvalid('guide')"
            placeholder="ABC1234567"
            maxlength="10"
            style="text-transform: uppercase;">
          <small class="text-sm text-gray-500 mt-1 block">
            Ingrese 10 caracteres alfanuméricos únicos
          </small>
          <div *ngIf="isFieldInvalid('guide')" class="text-sm text-red-600 mt-1">
            {{ getFieldError('guide') }}
          </div>
        </div>
      </div>

      <!-- Información de Transporte y Destino -->
      <div class="bg-white rounded-lg shadow-sm border p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-6 pb-2 border-b border-gray-200">Transporte y Destino</h2>

        <!-- Mostrar tipo de delivery automático si hay producto seleccionado -->
        <div *ngIf="currentDeliveryType" class="mb-6">
          <p class="text-sm text-gray-700 mb-2"><strong>Tipo de Entrega:</strong></p>
          <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"
                [class.bg-blue-100]="currentDeliveryType === 'maritime'"
                [class.text-blue-800]="currentDeliveryType === 'maritime'"
                [class.bg-green-100]="currentDeliveryType === 'terrestrial'"
                [class.text-green-800]="currentDeliveryType === 'terrestrial'">
            {{ currentDeliveryType === 'maritime' ? 'Marítimo' : 'Terrestre' }}
          </span>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-2">
            <label for="transport_unit_id" class="block text-sm font-medium text-gray-700">Unidad de Transporte *</label>
            <select
              id="transport_unit_id"
              formControlName="transport_unit_id"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"
              [class.border-red-500]="isFieldInvalid('transport_unit_id')"
              [class.focus:ring-red-500]="isFieldInvalid('transport_unit_id')"
              [class.focus:border-red-500]="isFieldInvalid('transport_unit_id')">
              <option value="">Seleccione unidad de transporte</option>
              <option *ngFor="let unit of transportUnits" [value]="unit.id">
                {{ unit.identifier }} ({{ unit.unit_type === 'fleet' ? 'Flota' : 'Vehículo' }})
              </option>
            </select>
            <div *ngIf="isFieldInvalid('transport_unit_id')" class="text-sm text-red-600 mt-1">
              {{ getFieldError('transport_unit_id') }}
            </div>
          </div>

          <div class="space-y-2">
            <label for="destination_id" class="block text-sm font-medium text-gray-700">Destino *</label>
            <select
              id="destination_id"
              formControlName="destination_id"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"
              [class.border-red-500]="isFieldInvalid('destination_id')"
              [class.focus:ring-red-500]="isFieldInvalid('destination_id')"
              [class.focus:border-red-500]="isFieldInvalid('destination_id')">
              <option value="">Seleccione destino</option>
              <option *ngFor="let destination of destinations" [value]="destination.id">
                {{ destination.name }}
                ({{ destination.destination_type === 'seaport' ? 'Puerto' : 'Almacén Terrestre' }})
              </option>
            </select>
            <div *ngIf="isFieldInvalid('destination_id')" class="text-sm text-red-600 mt-1">
              {{ getFieldError('destination_id') }}
            </div>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="bg-white rounded-lg shadow-sm border p-6">
        <div class="flex flex-col sm:flex-row gap-4 justify-end">
          <button
            type="button"
            class="px-6 py-2 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
            (click)="onCancel()"
            [disabled]="isSubmitting">
            Cancelar
          </button>

          <button
            type="submit"
            class="px-6 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
            [disabled]="isSubmitting">
            <span *ngIf="isSubmitting" class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></span>
            {{ isSubmitting ? 'Registrando...' : 'Registrar Entrega' }}
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
